{% extends 'base.html' %}
<body>
    {% block content %}
    {% for item in post_list %}
        {{ item.categories }}<br />
        {{ item.text }} {% include 'like.html' %}
         <!-- <a href="{%url 'like' user_id=user.pk post_id=item.pk %}">いいねん</a>{{ item.like_count }}<br /><br /> -->
    {% endfor %}
    <input id="like" type="button" value="button" onclick="buttonClick()">
    <script>
        $(document).ready(function(event){
            $(document).on('click', '#like', function(event){
                let post_id = $(this).attr('name')
                console.log(url)
                event.preventDefault();
                $.ajax({
                    type: 'POST',
                    url: "{% url 'like' user_id=user.pk post_id=${post_id} %}" ,
                    data: {
                        'post.id': $(this).attr('name'),
                        'csrfmiddlewaretoken': '{{ csrf_token }}'},
                        dataType: 'json',
                        success: function(response){
                            selector = document.getElementsByName(response.post.id);
                            if(response.liked){
                                $(selector).html("<i class='fas fa-lg fa-heart'></i>");
                            }
                            else {
                                $(selector).html("<i class='far fa-lg fa-heart'></i>");
                            }
                            selector2 = document.getElementsByName(response.post_id + "-count");
                            $(selector2).text(response.count);
                        }
                    });
                });
            });
            </script>
        {% endblock content %}
        </body>